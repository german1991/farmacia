<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Envíos - Farmacia</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<nav class="nav">

    <a href="index.html" class="nav-home">Inicio</a>

    <details>
        <summary>Trabajo</summary>
        <a href="ingreso.html">Ingreso de pedidos</a>
        <a href="salidaPedidos.html">Salida de pedidos</a>
        <a href="envios.html">Envíos</a>
        <a href="arqueo.html">Arqueo Caja</a>
        <a href="index.html">Imprimir</a>
    </details>

    <details>
        <summary>Administración</summary>
        <a href="planCuentas.html">Plan de cuentas</a>
        <a href="cuentaCorriente.html">Cuenta corriente</a>
        <a href="reportesClientes.html">Reporte clientes</a>
        <a href="cuentas.html">Alta de clientes</a>
    </details>

    <details>
        <summary>Gerencia</summary>
        <a href="reportes.html">Reportes</a>
        <a href="usuarios.html">Usuarios y permisos</a>
    </details>

    <details>
        <summary>Sistema</summary>
        <a href="configuracion.html">Configuración</a>
        <a href="auditoria.html">Auditoría</a>
    </details>

</nav>

<main class="container">

  <div class="card">
    <h3>Envíos registrados</h3>
    <div id="envios-list"></div>
  </div>

  <div style="margin-top:16px" class="card">
    <h3>Crear envío manual</h3>

    <form id="form-envio">

      <div class="form-row">

        <!-- FECHA POR DEFECTO -->
        <input class="input" type="date" name="fecha" id="fecha">

        <!-- NRO OPERACION -->
        <input class="input" name="nroOperacion" placeholder="N° operación">

      </div>

      <div>
        <button class="btn" type="submit">Cargar y confirmar el envío</button>
      </div>

    </form>
  </div>

  <div class="footer">Envíos</div>

</main>


<script>
/* ---------------------------- LOCAL STORAGE ---------------------------- */

function getEnvios() {
  return JSON.parse(localStorage.getItem("envios") || "[]");
}

function saveEnvios(lista) {
  localStorage.setItem("envios", JSON.stringify(lista));
}

/* ---------------------------- RENDER TABLA ----------------------------- */

function renderEnvios() {
  const envios = getEnvios();
  const div = document.getElementById("envios-list");

  if (envios.length === 0) {
    div.innerHTML = "<p>No hay envíos cargados</p>";
    return;
  }

  div.innerHTML = `
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>N° Operación</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        ${envios
          .map(
            e => `
              <tr>
                <td>${e.fecha}</td>
                <td>${e.nroOperacion}</td>
                <td>${e.estado}</td>
              </tr>
            `
          )
          .join("")}
      </tbody>
    </table>
  `;
}

/* ---------------------------- FORMULARIO ---------------------------- */

document.getElementById("form-envio").addEventListener("submit", (e) => {
  e.preventDefault();

  const fecha = document.getElementById("fecha").value.trim();
  const nroOperacion = e.target.nroOperacion.value.trim();

  if (!fecha) {
    alert("La fecha es obligatoria");
    return;
  }

  if (!nroOperacion) {
    alert("Ingrese el número de operación");
    return;
  }

  const envios = getEnvios();

  // Crear el registro
  envios.push({
    id: Date.now(),
    fecha,
    nroOperacion,
    estado: "Confirmado"
  });

  saveEnvios(envios);
  renderEnvios();
  e.target.reset();

  // volver a poner fecha de hoy
  document.getElementById('fecha').value = new Date().toISOString().split("T")[0];

  alert("Envío registrado correctamente");
});

/* ------------------------- FECHA POR DEFECTO -------------------------- */

document.getElementById('fecha').value = new Date().toISOString().split("T")[0];

/* ---------------------------- INICIO ---------------------------- */

renderEnvios();
</script>


<style>
  .nav {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.nav details summary {
    cursor: pointer;
    font-weight: bold;
    margin-bottom: 5px;
}

.nav a {
    display: block;
    margin-left: 10px;
    padding: 2px 0;
}

</style>

</body>
</html>
