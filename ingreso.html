<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ingreso Pedidos - Farmacia</title>

<style>
  body{font-family:Arial;background:#f5f5f5;margin:0;padding:20px;}
  .container{max-width:900px;margin:auto;}
  .card{background:white;padding:20px;border-radius:8px;margin-bottom:20px;}
  input,select,textarea{width:100%;padding:8px;margin-bottom:10px;border-radius:5px;border:1px solid #ccc;font-size:14px;}
  input[readonly]{background:#e6e6e6;color:#555;font-weight:bold;} /* gris */
  .btn{padding:10px 18px;border:none;border-radius:6px;cursor:pointer;font-size:15px;background:#4caf50;color:white;}
  .btn.ghost{background:#888;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{border:1px solid #ccc;padding:8px;text-align:left;font-size:14px;}
  th{background:#eee;}
  .del{background:#e53935;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;}
  .preview-img img{max-width:120px;border-radius:6px;margin-top:5px}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h3>Crear nuevo pedido</h3>

<form id="form-ingreso">

<label>N° Operación:</label>
<input type="text" id="nroOperacion" readonly>

<label>Fecha:</label>
<input type="date" id="fecha" readonly>

<label>DR/DRa que receta (Cliente):</label>
<input type="text" id="cliente">

<label>Nombre del paciente:</label>
<input type="text" id="paciente">

<label>Número de RP:</label>
<input type="text" id="rp">

<label>Detalles / Observaciones:</label>
<textarea id="detalles" rows="3"></textarea>

<label>Envío:</label>
<input type="text" id="envio">

<label>Canal de pago:</label>
<select id="canal">
  <option>Tarjeta de crédito</option>
  <option>Mercado Pago</option>
  <option>Banco 1</option>
  <option>Banco 2</option>
  <option>Cuenta corriente</option>
</select>

<label>Foto receta (si hay):</label>
<input type="file" accept="image/*" id="fotoReceta">

<label>Foto pago (si corresponde):</label>
<input type="file" accept="image/*" id="fotoPago">

<button class="btn" type="submit">Cargar</button>
<a href="index.html" class="btn ghost">Volver</a>

</form>
</div>

<div class="card">
<h3>Pedidos Cargados</h3>
<div id="listaPedidos"></div>
</div>

</div>

<script>
// --- inicialización datos ---
document.getElementById("fecha").value = new Date().toISOString().split('T')[0];
let op = parseInt(localStorage.getItem("op") ?? 1);
document.getElementById("nroOperacion").value = op;

// Obtener pedidos existentes
let pedidos = JSON.parse(localStorage.getItem("pedidos") || "[]");
render();

// --- Guardar Pedido ---
document.getElementById("form-ingreso").addEventListener("submit", e=>{
    e.preventDefault();

    let pedido = {
        id: op,
        fecha: document.getElementById("fecha").value,
        cliente: document.getElementById("cliente").value,
        paciente: document.getElementById("paciente").value,
        rp: document.getElementById("rp").value,
        detalles: document.getElementById("detalles").value,
        envio: document.getElementById("envio").value,
        canal: document.getElementById("canal").value
    }

    pedidos.push(pedido);
    localStorage.setItem("pedidos",JSON.stringify(pedidos));

    alert("Pedido cargado correctamente");
    
    op++;
    localStorage.setItem("op",op);
    document.getElementById("nroOperacion").value = op;

    render();
    e.target.reset();
});

// --- Mostrar pedidos en tabla ---
function render(){
    if(pedidos.length===0){
        document.getElementById("listaPedidos").innerHTML="Sin pedidos cargados";
        return;
    }

    let html = `
    <table>
    <tr>
      <th>N°</th><th>Fecha</th><th>Cliente</th><th>Paciente</th><th>RP</th><th>Canal</th><th>Acciones</th>
    </tr>`;

    pedidos.forEach((p,i)=>{
        html+=`
        <tr>
          <td>${p.id}</td>
          <td>${p.fecha}</td>
          <td>${p.cliente}</td>
          <td>${p.paciente}</td>
          <td>${p.rp}</td>
          <td>${p.canal}</td>
          <td><button class="del" onclick="eliminar(${i})">Eliminar</button></td>
        </tr>`;
    });

    html+="</table>";
    document.getElementById("listaPedidos").innerHTML = html;
}

// --- Eliminar pedido ---
function eliminar(i){
    if(confirm("¿Eliminar pedido?")){
        pedidos.splice(i,1);
        localStorage.setItem("pedidos",JSON.stringify(pedidos));
        render();
    }
}
</script>

</body>
</html>
