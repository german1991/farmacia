<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ingreso Pedidos - Farmacia</title>

  <style>
    :root {
      --bg: #f6f7fb;
      --card: #fff;
      --accent: #0ea5a1;
      --muted: #6b7280;
    }

    * { box-sizing: border-box; }

    body {
      font-family: Inter, system-ui, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      color: #111;
      padding: 0;
    }

    .header {
      background: var(--card);
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 20px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .nav { display: flex; gap: 20px; margin-left: auto; }
    .nav details summary {
      cursor: pointer;
      font-weight: bold;
    }
    .nav a {
      text-decoration: none;
      color: #111;
      padding: 4px 0;
      display: block;
    }
    .nav a:hover { background: #eef2f2; border-radius: 4px; }

    .container{max-width:900px;margin:auto;padding:20px;}
    .card{background:white;padding:20px;border-radius:8px;margin-bottom:20px;}
    input,select,textarea{
      width:100%;padding:8px;margin-bottom:10px;
      border-radius:5px;border:1px solid #ccc;font-size:14px;
    }
    input[readonly]{background:#e6e6e6;color:#555;font-weight:bold;}
    .btn{
      padding:10px 18px;border:none;border-radius:6px;
      cursor:pointer;font-size:15px;background:#0ea5a1;color:white;
    }
    .btn.ghost{background:#888;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{border:1px solid #ccc;padding:8px;text-align:left;font-size:14px;}
    th{background:#eee;}
    .del{
      background:#e53935;color:white;border:none;
      padding:5px 10px;border-radius:4px;cursor:pointer;
    }
  </style>
</head>

<body>

<header class="header">
  <nav class="nav">
    <a href="index.html" class="nav-home">Inicio</a>
  </nav>
</header>

<div class="container">

<div class="card">
<h3>Crear nuevo pedido</h3>

<form id="form-ingreso">

<label>N° Operación:</label>
<input type="text" id="nroOperacion" readonly>

<label>Fecha:</label>
<input type="date" id="fecha" readonly>

<label>DR/DRa que receta (Cliente):</label>
<input type="text" id="cliente" required>

<label>Nombre del paciente:</label>
<input type="text" id="paciente">

<label>Número de RP:</label>
<input type="text" id="rp">

<label>Detalles / Observaciones:</label>
<textarea id="detalles" rows="3"></textarea>

<label>Envío:</label>
<input type="text" id="envio">

<label>Canal de pago:</label>
<select id="canal">
  <option>Tarjeta de crédito</option>
  <option>Mercado Pago</option>
  <option>Banco 1</option>
  <option>Banco 2</option>
  <option>Cuenta corriente</option>
</select>

<label>Foto receta (si hay):</label>
<input type="file" accept="image/*" id="fotoReceta">

<label>Foto pago (si corresponde):</label>
<input type="file" accept="image/*" id="fotoPago">

<button class="btn" type="submit">Cargar</button>

</form>
</div>

<div class="card">
<h3>Pedidos Cargados</h3>
<div id="listaPedidos"></div>
</div>

</div>

<script>

// --- Inicialización ---
function fechaHoy(){
  return new Date().toISOString().split('T')[0];
}

document.getElementById("fecha").value = fechaHoy();

let op = parseInt(localStorage.getItem("op") ?? 1);
document.getElementById("nroOperacion").value = op;

let pedidos = JSON.parse(localStorage.getItem("pedidos") || "[]");
render();

// --- Guardar Pedido ---
document.getElementById("form-ingreso").addEventListener("submit", e=>{
    e.preventDefault();

    let clienteInput = document.getElementById("cliente").value.trim().toUpperCase();

    // Validación obligatoria
    if(clienteInput === ""){
        alert("Debe ingresar DR o DRA que receta.");
        return;
    }

    // Validar que empiece con DR o DRA
    if(!(clienteInput.startsWith("DR ") || clienteInput.startsWith("DRA "))){
        alert("El nombre debe comenzar con DR o DRA.");
        return;
    }

    let pedido = {
        id: op,
        fecha: document.getElementById("fecha").value,
        cliente: clienteInput,
        paciente: document.getElementById("paciente").value,
        rp: document.getElementById("rp").value,
        detalles: document.getElementById("detalles").value,
        envio: document.getElementById("envio").value,
        canal: document.getElementById("canal").value
    }

    pedidos.push(pedido);
    localStorage.setItem("pedidos",JSON.stringify(pedidos));

    alert("Pedido cargado correctamente");

    op++;
    localStorage.setItem("op",op);
    document.getElementById("nroOperacion").value = op;

    render();

    e.target.reset();
    document.getElementById("fecha").value = fechaHoy();
});

// --- Mostrar pedidos ---
function render(){
    if(pedidos.length===0){
        document.getElementById("listaPedidos").innerHTML="Sin pedidos cargados";
        return;
    }

    let html = `
    <table>
    <tr>
      <th>N°</th><th>Fecha</th><th>Cliente</th><th>Paciente</th>
      <th>RP</th><th>Canal</th><th>Acciones</th>
    </tr>`;

    pedidos.forEach((p,i)=>{
        html+=`
        <tr>
          <td>${p.id}</td>
          <td>${p.fecha}</td>
          <td>${p.cliente}</td>
          <td>${p.paciente}</td>
          <td>${p.rp}</td>
          <td>${p.canal}</td>
          <td><button class="del" onclick="eliminar(${i})">Eliminar</button></td>
        </tr>`;
    });

    html+="</table>";
    document.getElementById("listaPedidos").innerHTML = html;
}

// --- Eliminar pedido ---
function eliminar(i){
    if(confirm("¿Eliminar pedido?")){
        pedidos.splice(i,1);
        localStorage.setItem("pedidos",JSON.stringify(pedidos));
        render();
    }
}

</script>

</body>
</html>
